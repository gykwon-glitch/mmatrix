% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mmatrix.R
\name{mmatrix}
\alias{mmatrix}
\title{Schema-safe sparse model matrix with QR-based collinearity handling}
\usage{
mmatrix(
  formula,
  data,
  collin_tol = 1e-09,
  prefer_keep = NULL,
  prefer_keep_hard = FALSE,
  contrasts.arg = NULL,
  xlev = NULL,
  na_as_level = FALSE,
  other_level = "Other"
)
}
\arguments{
\item{formula}{A model formula.}

\item{data}{A (cleaned) model.frame or data.frame.}

\item{collin_tol}{Numeric tolerance for \eqn{R} diagonal (rank-def detection).}

\item{prefer_keep}{Character vector of column names to prioritize when
resolving rank-deficiency. Columns in \code{prefer_keep} are annotated
and given higher priority, but may still be removed unless
\code{prefer_keep_hard = TRUE}.}

\item{prefer_keep_hard}{Logical; if \code{TRUE}, columns listed in
\code{prefer_keep} are never considered as drop candidates in the
collinearity resolution step. This may leave the final design matrix
rank-deficient if collinearity only involves hard-protected columns.}

\item{contrasts.arg}{Passed to \code{sparse.model.matrix}.}

\item{xlev}{Passed to \code{sparse.model.matrix}.}

\item{na_as_level}{Logical; treat NA as its own factor level.}

\item{other_level}{Level to map unseen levels to ("Other").}
}
\value{
An object of class \code{mmatrix_spec}
}
\description{
Builds a sparse design matrix via \code{Matrix::sparse.model.matrix},
drops aliased columns using a numerically stabilized QR.
}
